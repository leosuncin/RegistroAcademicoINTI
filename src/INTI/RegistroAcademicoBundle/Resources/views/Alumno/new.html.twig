{% extends 'RegistroAcademicoBundle:Default:layout.html.twig' %}

{% block style %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('assets/jquery-ui/css/smoothness/jquery-ui.css') }}" />
<link rel="stylesheet" href="{{ asset('assets/jquery-ui/css/smoothness/jquery.ui.theme.css') }}" />
{% endblock %}

{% block breadcrumb %}
<li><span class="divider">&gt;</span> <a href="{{ path('index') }}">Inicio</a></li>
<li><span class="divider">&gt;</span> <a href="{{ path('alumno_index') }} ">Alumno</a></li>
<li class="active"><span class="divider">&gt;</span> Crear</li>
{% endblock %}

{% block content %}
<form id="newAlumnoForm" action="{{ path('alumno_create') }}" method="post" {{ form_enctype(form) }} class="form-horizontal">
	<div style="border:solid 1px #000;padding:15px"><h3>Buscar Aspirante:</h3> <input type='text' id='search' placeholder='Nombre o N° de Aspirante'> Año: <input type="number" id='anho' class='span1'> Especialidad: <select id='esp'></select>
	<div id='resultTable'></div></div>
	<br>
	<table>
		<tr><td>N° de Aspirante:</td><td><input type='number' id='nAspirante' name='nAspirante'></td></tr>
		<tr><td>NIE:</td><td><input type='text' id='nie' name='nie'></td></tr>
		<tr><td>Condicion de Matricula:</td><td><select id='cond' name='cond'><option value='CC'>Condicionado Conducta</option><option value='CM'>Condicionado Matricula</option><option value='RE'>Repetidor</option><option value='RI'>Reingreso</option><option value='NI' selected>Nuevo Ingreso</option></select></td></tr>
	</table>
	<div class="form-actions">
        <input type="button" value="Crear" class="btn btn-primary" />
        <a href="{{ path('aspirante_index') }}" class="btn">Regresar</a>
    </div>
    <div class="control-group error">
        {{ form_errors(form) }}
    </div>
</form>
{% endblock %}

{% block javascript %}
{{ parent() }}
<script src="{{ asset('assets/jquery-ui/js/jquery-ui.js') }}"></script>
<script>
	$(document).ready(init);
	function init(){
		getEspecialidades();
		showTable();
		$("#search").keyup(showTable);
		$("#esp").change(showTable);
		$("#anho").change(showTable);
		$("input[value='Crear']").click(saveAlumno);
	}
	function saveAlumno(){
		$.get("{{ path('alumnoInsertAjax') }}", {"nie":$("#nie").val(), "nAspirante":$("#nAspirante").val(), "cond":$("#cond").val()}, function(e){
			document.location.href=e;
		});
	}
	function getEspecialidades(){
		$.get("{{ path('especialidadAjax') }}", {}, function(e){
			$("#esp").html(e);
		});
	}
	function showTable(){
		$.get("{{ path('aspiranteAjax') }}", {"searchValue":$("#search").val(), "anho":$("#anho").val(), "esp":$("#esp").val()}, function(e){
			$("#resultTable").html(e);
			$("tr.aspirante").click(function(){
				$("#nAspirante").val($(this).find("td.n_asp").attr('value'));
			});
		});
	}
</script>
{% endblock %}
